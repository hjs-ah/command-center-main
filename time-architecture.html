<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Time Architecture Tool</title>
    <style>
        :root {
            --bg-page: #ffffff;
            --bg-card: #f8f9fa;
            --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a;
            --text-muted: #7a7a7a;
            --accent-color: #ffe000;
            --border-color: #e5e5e5;
            --shadow: rgba(0, 0, 0, 0.05);
        }
        [data-theme="dark"] {
            --bg-page: #0a0a0a;
            --bg-card: #1a1a1a;
            --text-primary: #f0f0f0;
            --text-secondary: #b0b0b0;
            --text-muted: #808080;
            --accent-color: #ffe000;
            --border-color: #2a2a2a;
            --shadow: rgba(255, 255, 255, 0.05);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-page);
            color: var(--text-primary);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
            padding: 0;
            margin: 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 80px 24px 60px;
        }
        header {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 16px;
            align-items: center;
            margin-bottom: 40px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
        }
        h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.02em;
        }
        .subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 8px;
            font-weight: 500;
        }
        .controls { display: flex; gap: 12px; align-items: center; }
        .btn {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: var(--accent-color);
            color: var(--text-primary);
            border-color: var(--accent-color);
        }
        
        /* Section Separator */
        .section-separator {
            height: 1px;
            background: var(--accent-color);
            opacity: 0.3;
            margin: 40px 0;
        }

        /* Weekly Time Allocation Framework */
        .framework-section {
            margin-bottom: 48px;
        }
        .framework-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .framework-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }
        .allocation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 12px;
            margin-bottom: 24px;
        }
        .allocation-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            transition: all 0.3s ease;
        }
        .allocation-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        
        .allocation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .allocation-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }
        .allocation-hours {
            font-size: 14px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .allocation-description {
            font-size: 11px;
            color: var(--text-muted);
            line-height: 1.5;
            margin-bottom: 12px;
        }
        .allocation-input {
            width: 100%;
            background: var(--bg-page);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 6px 8px;
            font-size: 12px;
            color: var(--text-primary);
            transition: border-color 0.2s ease;
        }
        .allocation-input:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .percentage-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }
        .percentage-item {
            text-align: center;
            padding: 16px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .percentage-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .percentage-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            margin-bottom: 4px;
        }
        .percentage-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0;
        }

        /* Weekly Calendar */
        .calendar-section {
            margin-bottom: 48px;
        }
        .calendar-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        .calendar-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }
        .calendar-grid {
            overflow-x: auto;
        }
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .calendar-table th {
            background: var(--bg-card);
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        .calendar-table td {
            height: 80px;
            border: 1px solid var(--border-color);
            padding: 4px;
            vertical-align: top;
            cursor: pointer;
            transition: background 0.2s ease;
            background: var(--bg-card);
        }
        .calendar-table td:hover {
            background: var(--bg-page);
        }
        .time-label {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 600;
            text-align: right;
            padding-right: 12px;
            background: var(--bg-card);
        }

        /* Time Protection Rules */
        .rules-section {
            margin-bottom: 48px;
        }
        .rules-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            margin-bottom: 8px;
        }
        .rules-toggle {
            font-size: 14px;
            margin-right: 8px;
            transition: transform 0.2s ease;
            color: var(--text-muted);
        }
        .rules-toggle.collapsed {
            transform: rotate(-90deg);
        }
        .rules-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        .rules-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }
        .rules-content {
            display: block;
        }
        .rules-content.collapsed {
            display: none;
        }
        .rule-item {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }
        .rule-item:hover {
            background: var(--bg-page);
        }
        .rule-checkbox {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            cursor: pointer;
            flex-shrink: 0;
            margin-top: 2px;
            accent-color: var(--accent-color);
        }
        .rule-text {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-primary);
        }
        .rule-label {
            font-weight: 600;
            margin-right: 4px;
        }
        
        /* Domain Tabs */
        .domain-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }
        .domain-tab {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s ease;
        }
        .domain-tab:hover {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: var(--text-primary);
        }
        .domain-tab.active {
            background: var(--accent-color);
            color: var(--text-primary);
            border-color: var(--accent-color);
        }
        .domain-content { display: none; }
        .domain-content.active { display: block; }
        
        .time-blocks {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
            margin-top: 30px;
        }
        .time-block {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .time-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }
        .block-header {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--accent-color);
            color: var(--text-primary);
        }
        .block-slots { display: flex; flex-direction: column; gap: 8px; }
        .slot {
            background: var(--bg-page);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            font-size: 12px;
            transition: border-color 0.2s ease;
        }
        .slot:hover {
            border-color: var(--text-muted);
        }
        .slot input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--text-primary);
            outline: none;
            font-size: 12px;
            font-weight: 600;
        }
        .slot .time-input {
            display: flex;
            gap: 4px;
            margin-top: 4px;
            font-size: 10px;
        }
        .slot .time-input input[type="time"],
        .slot .time-input select {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 10px;
            color: var(--text-primary);
        }
        .slot .time-input input[type="time"]:focus,
        .slot .time-input select:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        .add-slot {
            width: 100%;
            padding: 8px;
            margin-top: 8px;
            background: transparent;
            border: 2px dashed var(--border-color);
            border-radius: 4px;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        .add-slot:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Time Architecture Tool</h1>
                <p class="subtitle">Mechanize your calendar for strategic execution</p>
            </div>
            <div class="controls">
                <button class="btn" onclick="toggleTheme()">üåô Light Mode</button>
                <button class="btn" onclick="saveAll()">üíæ Save All</button>
                <button class="btn" onclick="exportData()">üìä Export</button>
                <a href="index.html" class="btn">‚Üê Dashboard</a>
            </div>
        </header>

        <!-- Weekly Time Allocation Framework -->
        <div class="framework-section">
            <h2 class="framework-title">Weekly Time Allocation Framework</h2>
            <p class="framework-subtitle">Based on your 9AM start and existing deep work structure. Adjust hours as needed.</p>
            
            <div class="allocation-grid">
                <div class="allocation-card">
                    <div class="allocation-header">
                        <span class="allocation-title">üéØ Deep Work</span>
                        <span class="allocation-hours">13.5 hrs</span>
                    </div>
                    <p class="allocation-description">Doctoral writing, strategic planning - non-negotiable, calendar-blocked, phone off</p>
                    <input type="number" class="allocation-input" id="deep-work-hours" value="13.5" step="0.5" onchange="updateAllocation('deep-work', this.value)">
                </div>

                <div class="allocation-card">
                    <div class="allocation-header">
                        <span class="allocation-title">ü§ù Collaborative Work</span>
                        <span class="allocation-hours">9 hrs</span>
                    </div>
                    <p class="allocation-description">Team meetings, stakeholder engagement, mentorship, partnership discussions</p>
                    <input type="number" class="allocation-input" id="collaborative-hours" value="9" step="0.5" onchange="updateAllocation('collaborative', this.value)">
                </div>

                <div class="allocation-card">
                    <div class="allocation-header">
                        <span class="allocation-title">‚ö° Reactive Work</span>
                        <span class="allocation-hours">6 hrs</span>
                    </div>
                    <p class="allocation-description">Email, urgent ministry needs, administrative tasks, firefighting</p>
                    <input type="number" class="allocation-input" id="reactive-hours" value="6" step="0.5" onchange="updateAllocation('reactive', this.value)">
                </div>

                <div class="allocation-card">
                    <div class="allocation-header">
                        <span class="allocation-title">üîó Integration Time</span>
                        <span class="allocation-hours">3.5 hrs</span>
                    </div>
                    <p class="allocation-description">Where doctoral research informs community work - your unique advantage</p>
                    <input type="number" class="allocation-input" id="integration-hours" value="3.5" step="0.5" onchange="updateAllocation('integration', this.value)">
                </div>

                <div class="allocation-card">
                    <div class="allocation-header">
                        <span class="allocation-title">üë• People Development</span>
                        <span class="allocation-hours">2.5 hrs</span>
                    </div>
                    <p class="allocation-description">Coaching, mentoring, developing team members and ministry leaders</p>
                    <input type="number" class="allocation-input" id="people-dev-hours" value="2.5" step="0.5" onchange="updateAllocation('people-dev', this.value)">
                </div>
            </div>

            <div class="percentage-display">
                <div class="percentage-item">
                    <div class="percentage-label">Deep Work</div>
                    <div class="percentage-value" id="deep-work-percent">39%</div>
                </div>
                <div class="percentage-item">
                    <div class="percentage-label">Collaborative</div>
                    <div class="percentage-value" id="collaborative-percent">26%</div>
                </div>
                <div class="percentage-item">
                    <div class="percentage-label">Reactive</div>
                    <div class="percentage-value" id="reactive-percent">17%</div>
                </div>
                <div class="percentage-item">
                    <div class="percentage-label">Integration</div>
                    <div class="percentage-value" id="integration-percent">10%</div>
                </div>
                <div class="percentage-item">
                    <div class="percentage-label">People Development</div>
                    <div class="percentage-value" id="people-dev-percent">7%</div>
                </div>
            </div>
        </div>

        <!-- This Week's Time Architecture -->
        <div class="calendar-section">
            <h2 class="calendar-title">This Week's Time Architecture</h2>
            <p class="calendar-subtitle">Click cells to add time blocks. Each block represents your committed time allocation.</p>
            
            <div class="calendar-grid">
                <table class="calendar-table">
                    <thead>
                        <tr>
                            <th style="width: 100px;">Time</th>
                            <th>Monday</th>
                            <th>Tuesday</th>
                            <th>Wednesday</th>
                            <th>Thursday</th>
                            <th>Friday</th>
                        </tr>
                    </thead>
                    <tbody id="calendar-body">
                        <tr>
                            <td class="time-label">9AM-12PM</td>
                            <td onclick="addCalendarBlock(this, 'Monday', '9AM-12PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Tuesday', '9AM-12PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Wednesday', '9AM-12PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Thursday', '9AM-12PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Friday', '9AM-12PM')"></td>
                        </tr>
                        <tr>
                            <td class="time-label">12PM-2PM</td>
                            <td onclick="addCalendarBlock(this, 'Monday', '12PM-2PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Tuesday', '12PM-2PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Wednesday', '12PM-2PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Thursday', '12PM-2PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Friday', '12PM-2PM')"></td>
                        </tr>
                        <tr>
                            <td class="time-label">2PM-5PM</td>
                            <td onclick="addCalendarBlock(this, 'Monday', '2PM-5PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Tuesday', '2PM-5PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Wednesday', '2PM-5PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Thursday', '2PM-5PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Friday', '2PM-5PM')"></td>
                        </tr>
                        <tr>
                            <td class="time-label">5PM-6PM</td>
                            <td onclick="addCalendarBlock(this, 'Monday', '5PM-6PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Tuesday', '5PM-6PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Wednesday', '5PM-6PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Thursday', '5PM-6PM')"></td>
                            <td onclick="addCalendarBlock(this, 'Friday', '5PM-6PM')"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Time Protection Rules -->
        <div class="rules-section">
            <div class="rules-header" onclick="toggleRules()">
                <span class="rules-toggle" id="rules-toggle">‚ñº</span>
                <h2 class="rules-title">Time Protection Rules</h2>
            </div>
            <p class="rules-subtitle">Protect your strategic priorities as fiercely as Sunday sermon prep</p>
            
            <div class="rules-content" id="rules-content">
                <div class="rule-item">
                    <input type="checkbox" class="rule-checkbox" id="rule-1" onchange="saveRules()">
                    <label for="rule-1" class="rule-text">
                        <span class="rule-label">Deep Work Blocking:</span> Schedule 2 deep work sessions (60-90 min each) at start of work day, mark as "Focus Time" in calendar
                    </label>
                </div>

                <div class="rule-item">
                    <input type="checkbox" class="rule-checkbox" id="rule-2" onchange="saveRules()">
                    <label for="rule-2" class="rule-text">
                        <span class="rule-label">Email Batching:</span> Check email only at 12PM and 4PM, not first thing in morning
                    </label>
                </div>

                <div class="rule-item">
                    <input type="checkbox" class="rule-checkbox" id="rule-3" onchange="saveRules()">
                    <label for="rule-3" class="rule-text">
                        <span class="rule-label">Meeting Clustering:</span> Schedule all meetings in 2-3 dedicated blocks per week, preserve other days for deep work
                    </label>
                </div>

                <div class="rule-item">
                    <input type="checkbox" class="rule-checkbox" id="rule-4" onchange="saveRules()">
                    <label for="rule-4" class="rule-text">
                        <span class="rule-label">Integration Scheduling:</span> Weekly 2-hour block to connect doctoral research with Builder's Conference/Chess Not Checkers
                    </label>
                </div>

                <div class="rule-item">
                    <input type="checkbox" class="rule-checkbox" id="rule-5" onchange="saveRules()">
                    <label for="rule-5" class="rule-text">
                        <span class="rule-label">Buffer Time:</span> 15-minute buffers between meetings for mental context switching and notes capture
                    </label>
                </div>

                <div class="rule-item">
                    <input type="checkbox" class="rule-checkbox" id="rule-6" onchange="saveRules()">
                    <label for="rule-6" class="rule-text">
                        <span class="rule-label">Weekly Review:</span> Friday 3-4PM blocked for strategic review and next week planning (non-negotiable)
                    </label>
                </div>
            </div>
        </div>

        <div class="section-separator"></div>

        <!-- Domain Tabs -->
        <div class="domain-tabs" id="domainTabs">
            <button class="domain-tab active" onclick="switchDomain('builders')">Builder's Conference</button>
            <button class="domain-tab" onclick="switchDomain('professional')">Professional/Career</button>
            <button class="domain-tab" onclick="switchDomain('chess')">Chess Not Checkers</button>
        </div>

        <div id="domainContents"></div>
    </div>

    <script>
        let currentDomain = 'builders';
        let data = {};
        let domains = [
            { id: 'builders', name: "Builder's Conference" },
            { id: 'professional', name: 'Professional/Career' },
            { id: 'chess', name: 'Chess Not Checkers' }
        ];
        let counter = 0;
        let allocations = {
            'deep-work': 13.5,
            'collaborative': 9,
            'reactive': 6,
            'integration': 3.5,
            'people-dev': 2.5
        };
        let calendarData = {};
        let rulesChecked = {};

        window.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadCustomDomains();
            loadData();
            loadAllocations();
            loadCalendarData();
            loadRules();
            renderAllDomains();
            switchDomain('builders');
            updatePercentages();
        });

        function loadCustomDomains() {
            const customDomains = JSON.parse(localStorage.getItem('customDomains') || '[]');
            const tabsContainer = document.getElementById('domainTabs');
            
            customDomains.forEach(domain => {
                domains.push({ id: domain.id, name: domain.name });
                
                const tab = document.createElement('button');
                tab.className = 'domain-tab';
                tab.textContent = domain.name;
                tab.onclick = () => switchDomain(domain.id);
                tabsContainer.appendChild(tab);
            });
        }

        function switchDomain(domainId) {
            currentDomain = domainId;
            
            document.querySelectorAll('.domain-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            document.querySelectorAll('.domain-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const content = document.getElementById(`${domainId}-content`);
            if (content) {
                content.classList.add('active');
            }
        }

        function renderAllDomains() {
            const container = document.getElementById('domainContents');
            container.innerHTML = '';
            
            domains.forEach((domain, index) => {
                const domainContent = createDomainHTML(domain.id, domain.name, index === 0);
                container.appendChild(domainContent);
            });
            
            renderAll();
        }

        function createDomainHTML(domainId, domainName, isActive) {
            const div = document.createElement('div');
            div.id = `${domainId}-content`;
            div.className = `domain-content ${isActive ? 'active' : ''}`;
            
            div.innerHTML = `
                <div class="time-blocks">
                    <div class="time-block">
                        <div class="block-header">üéØ Deep Work</div>
                        <div class="block-slots" id="${domainId}-deep-work"></div>
                        <button class="add-slot" onclick="addSlot('${domainId}', 'deep-work')">+ Add Time Block</button>
                    </div>

                    <div class="time-block">
                        <div class="block-header">ü§ù Collaborative Work</div>
                        <div class="block-slots" id="${domainId}-collaborative"></div>
                        <button class="add-slot" onclick="addSlot('${domainId}', 'collaborative')">+ Add Time Block</button>
                    </div>

                    <div class="time-block">
                        <div class="block-header">üë• People Development</div>
                        <div class="block-slots" id="${domainId}-people-dev"></div>
                        <button class="add-slot" onclick="addSlot('${domainId}', 'people-dev')">+ Add Time Block</button>
                    </div>

                    <div class="time-block">
                        <div class="block-header">üìß Reactive Tasks</div>
                        <div class="block-slots" id="${domainId}-reactive"></div>
                        <button class="add-slot" onclick="addSlot('${domainId}', 'reactive')">+ Add Time Block</button>
                    </div>

                    <div class="time-block">
                        <div class="block-header">üîÑ Integration Time</div>
                        <div class="block-slots" id="${domainId}-integration"></div>
                        <button class="add-slot" onclick="addSlot('${domainId}', 'integration')">+ Add Time Block</button>
                    </div>
                </div>
            `;
            
            return div;
        }

        function updateAllocation(type, value) {
            allocations[type] = parseFloat(value);
            updatePercentages();
            saveAllocations();
        }

        function updatePercentages() {
            const total = Object.values(allocations).reduce((a, b) => a + b, 0);
            
            Object.keys(allocations).forEach(type => {
                const percent = Math.round((allocations[type] / total) * 100);
                document.getElementById(`${type}-percent`).textContent = `${percent}%`;
                document.getElementById(`${type}-hours`).value = allocations[type];
            });
        }

        function addCalendarBlock(cell, day, time) {
            const activity = prompt(`Add activity for ${day} ${time}:`);
            if (activity && activity.trim()) {
                const key = `${day}-${time}`;
                calendarData[key] = activity;
                cell.innerHTML = `<div style="font-size: 11px; padding: 4px; background: var(--accent-color); border-radius: 3px; color: var(--text-primary); font-weight: 600;">${activity}</div>`;
                saveCalendarData();
            }
        }

        function toggleRules() {
            const toggle = document.getElementById('rules-toggle');
            const content = document.getElementById('rules-content');
            
            toggle.classList.toggle('collapsed');
            content.classList.toggle('collapsed');
        }

        function saveRules() {
            for (let i = 1; i <= 6; i++) {
                const checkbox = document.getElementById(`rule-${i}`);
                rulesChecked[`rule-${i}`] = checkbox.checked;
            }
            localStorage.setItem('time-protection-rules', JSON.stringify(rulesChecked));
        }

        function loadRules() {
            const saved = localStorage.getItem('time-protection-rules');
            if (saved) {
                rulesChecked = JSON.parse(saved);
                Object.keys(rulesChecked).forEach(key => {
                    const checkbox = document.getElementById(key);
                    if (checkbox) checkbox.checked = rulesChecked[key];
                });
            }
        }

        function saveAllocations() {
            localStorage.setItem('time-allocations', JSON.stringify(allocations));
        }

        function loadAllocations() {
            const saved = localStorage.getItem('time-allocations');
            if (saved) {
                allocations = JSON.parse(saved);
            }
        }

        function saveCalendarData() {
            localStorage.setItem('calendar-data', JSON.stringify(calendarData));
        }

        function loadCalendarData() {
            const saved = localStorage.getItem('calendar-data');
            if (saved) {
                calendarData = JSON.parse(saved);
                Object.keys(calendarData).forEach(key => {
                    const [day, time] = key.split('-');
                    const cells = document.querySelectorAll(`td[onclick*="${day}"][onclick*="${time}"]`);
                    cells.forEach(cell => {
                        cell.innerHTML = `<div style="font-size: 11px; padding: 4px; background: var(--accent-color); border-radius: 3px; color: var(--text-primary); font-weight: 600;">${calendarData[key]}</div>`;
                    });
                });
            }
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const btn = document.querySelector('.controls .btn');
            btn.textContent = newTheme === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        }

        function loadTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            
            const btn = document.querySelector('.controls .btn');
            if (btn) {
                btn.textContent = theme === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            }
        }

        function addSlot(domainId, type) {
            const task = prompt('Enter task/activity:');
            if (!task || task.trim() === '') return;
            counter++;
            
            if (!data[domainId]) {
                data[domainId] = {
                    'deep-work': [], 'collaborative': [], 'people-dev': [], 'reactive': [], 'integration': []
                };
            }
            
            data[domainId][type].push({ 
                id: `slot-${counter}`, 
                task, 
                start: '09:00', 
                end: '10:00', 
                day: 'Monday' 
            });
            renderDomain(domainId);
            save();
        }

        function deleteSlot(domainId, type, id) {
            data[domainId][type] = data[domainId][type].filter(s => s.id !== id);
            renderDomain(domainId);
            save();
        }

        function updateSlot(domainId, type, id, field, value) {
            const slot = data[domainId][type].find(s => s.id === id);
            if (slot) { 
                slot[field] = value; 
                save(); 
            }
        }

        function renderDomain(domainId) {
            if (!data[domainId]) {
                data[domainId] = {
                    'deep-work': [], 'collaborative': [], 'people-dev': [], 'reactive': [], 'integration': []
                };
            }
            
            const types = ['deep-work', 'collaborative', 'people-dev', 'reactive', 'integration'];
            
            types.forEach(type => {
                const container = document.getElementById(`${domainId}-${type}`);
                if (container) {
                    container.innerHTML = data[domainId][type].map(slot => `
                        <div class="slot">
                            <input type="text" value="${slot.task}" onchange="updateSlot('${domainId}', '${type}', '${slot.id}', 'task', this.value)" placeholder="Task">
                            <div class="time-input">
                                <select onchange="updateSlot('${domainId}', '${type}', '${slot.id}', 'day', this.value)" style="flex:1; background: var(--bg-card); border: 1px solid var(--border-color); padding: 2px; border-radius: 3px; font-size: 10px;">
                                    ${['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'].map(d => 
                                        `<option value="${d}" ${slot.day === d ? 'selected' : ''}>${d}</option>`
                                    ).join('')}
                                </select>
                                <input type="time" value="${slot.start}" onchange="updateSlot('${domainId}', '${type}', '${slot.id}', 'start', this.value)">
                                <span style="color: var(--text-muted);">-</span>
                                <input type="time" value="${slot.end}" onchange="updateSlot('${domainId}', '${type}', '${slot.id}', 'end', this.value)">
                                <button style="padding:2px 6px; background:transparent; border:1px solid var(--border-color); border-radius:3px; font-size:9px; cursor:pointer;" onclick="deleteSlot('${domainId}', '${type}', '${slot.id}')">üóëÔ∏è</button>
                            </div>
                        </div>
                    `).join('');
                }
            });
        }

        function renderAll() {
            domains.forEach(domain => {
                renderDomain(domain.id);
            });
        }

        function save() { 
            localStorage.setItem('time-architecture', JSON.stringify(data)); 
        }

        function saveAll() {
            save();
            saveAllocations();
            saveCalendarData();
            saveRules();
            alert('All data saved successfully!');
        }
        
        function loadData() {
            const saved = localStorage.getItem('time-architecture');
            if (saved) { 
                data = JSON.parse(saved); 
            } else {
                domains.forEach(domain => {
                    data[domain.id] = {
                        'deep-work': [], 'collaborative': [], 'people-dev': [], 'reactive': [], 'integration': []
                    };
                });
            }
            
            domains.forEach(domain => {
                if (!data[domain.id]) {
                    data[domain.id] = {
                        'deep-work': [], 'collaborative': [], 'people-dev': [], 'reactive': [], 'integration': []
                    };
                }
            });
        }

        function exportData() {
            const exportPackage = {
                timestamp: new Date().toISOString(),
                allocations,
                calendarData,
                rulesChecked,
                domains: data
            };
            
            const blob = new Blob([JSON.stringify(exportPackage, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob); 
            const a = document.createElement('a');
            a.href = url; 
            a.download = `time-architecture-complete-${new Date().toISOString().split('T')[0]}.json`;
            a.click(); 
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
