<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RACI Matrix | Executive Command Center</title>
    <style>
        :root {
            --bg-page: #ffffff; --bg-card: #f8f9fa; --text-primary: #1a1a1a;
            --text-secondary: #4a4a4a; --text-muted: #7a7a7a; --accent-color: #ffe000;
            --border-color: #e5e5e5; --shadow: rgba(0, 0, 0, 0.05);
        }
        [data-theme="dark"] {
            --bg-page: #0a0a0a; --bg-card: #1a1a1a; --text-primary: #f0f0f0;
            --text-secondary: #b0b0b0; --text-muted: #808080; --border-color: #2a2a2a;
            --shadow: rgba(255, 255, 255, 0.05);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-page); color: var(--text-primary); line-height: 1.6;
            padding: 40px 20px; transition: all 0.3s ease;
        }
        .container { max-width: 1600px; margin: 0 auto; }
        header { display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); }
        h1 { font-size: 28px; font-weight: 700; }
        .subtitle { font-size: 11px; color: var(--text-muted); margin-top: 4px; font-style: italic; }
        .controls { display: flex; gap: 12px; }
        .btn {
            background: var(--bg-card); border: 1px solid var(--border-color);
            padding: 8px 16px; border-radius: 6px; font-size: 12px; font-weight: 500;
            color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease; text-decoration: none;
        }
        .btn:hover { background: var(--bg-page); color: var(--text-primary);
            border-color: var(--text-muted); transform: translateY(-1px); }
        
        /* Domain Tabs */
        .domain-tabs { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap;
            border-bottom: 1px solid var(--border-color); padding-bottom: 12px; }
        .tab {
            padding: 8px 16px; background: transparent; border: 1px solid var(--border-color);
            border-radius: 6px 6px 0 0; cursor: pointer; font-size: 13px; font-weight: 600;
            color: var(--text-secondary); transition: all 0.2s ease;
        }
        .tab.active { background: var(--accent-color); color: #1a1a1a; border-color: var(--accent-color); }
        .domain-content { display: none; }
        .domain-content.active { display: block; }
        
        /* Team Section */
        .team-section { background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 24px; margin-bottom: 20px; }
        .section-header { font-size: 16px; font-weight: 700; margin-bottom: 16px; }
        .team-list { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 16px; }
        .team-member {
            background: var(--bg-page); border: 1px solid var(--border-color);
            padding: 8px 12px; border-radius: 20px; font-size: 12px; display: flex;
            align-items: center; gap: 8px;
        }
        .remove-member { cursor: pointer; color: var(--text-muted); font-weight: bold; }
        .remove-member:hover { color: #ef4444; }
        .add-member-form { display: flex; gap: 8px; }
        .add-member-form input {
            flex: 1; background: var(--bg-page); border: 1px solid var(--border-color);
            padding: 8px 12px; border-radius: 6px; font-size: 13px; color: var(--text-primary);
        }
        .btn-add {
            background: var(--accent-color); border: 1px solid var(--accent-color);
            color: #1a1a1a; padding: 8px 16px; border-radius: 6px; font-size: 13px;
            font-weight: 600; cursor: pointer; transition: all 0.2s ease;
        }
        .btn-add:hover { transform: translateY(-2px); box-shadow: 0 4px 12px var(--shadow); }
        
        /* Matrix Table */
        .matrix-table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        .matrix-table th, .matrix-table td {
            padding: 12px; text-align: left; border-bottom: 1px solid var(--border-color);
            font-size: 12px;
        }
        .matrix-table th { font-weight: 600; color: var(--text-muted); text-transform: uppercase;
            letter-spacing: 0.05em; font-size: 10px; }
        .matrix-table input[type="text"], .matrix-table input[type="date"] {
            width: 100%; background: var(--bg-page); border: 1px solid var(--border-color);
            padding: 6px 8px; border-radius: 4px; font-size: 12px; color: var(--text-primary);
        }
        .matrix-table select {
            background: var(--bg-page); border: 1px solid var(--border-color);
            padding: 6px 8px; border-radius: 4px; font-size: 11px; color: var(--text-primary);
        }
        .raci-cell { display: flex; align-items: center; gap: 4px; }
        .raci-checkbox { width: 16px; height: 16px; cursor: pointer; }
        .delete-task { background: transparent; border: 1px solid var(--border-color);
            padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer;
            color: var(--text-secondary); font-weight: 600; }
        .delete-task:hover { background: #ef4444; border-color: #ef4444; color: white; }
        
        /* Accountability Alert */
        .accountability-alert {
            background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444;
            border-radius: 6px; padding: 16px; margin-top: 20px; font-size: 13px;
        }

        /* Legend */
        .raci-legend {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .legend-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .legend-badge {
            background: var(--accent-color);
            color: #1a1a1a;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 11px;
            min-width: 24px;
            text-align: center;
        }

        .legend-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .legend-desc strong {
            display: block;
            color: var(--text-primary);
            font-size: 13px;
            margin-bottom: 2px;
        }

        /* Statistics */
        .stats-overview {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }

        .stat-card {
            text-align: center;
            padding: 12px;
            background: var(--bg-page);
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
        }

        .status-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            margin-right: 8px;
        }
        
        @media (max-width: 768px) {
            .domain-tabs { flex-direction: column; }
            .matrix-table { font-size: 11px; }
            .matrix-table th, .matrix-table td { padding: 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>RACI Matrix</h1>
                <p class="subtitle">Responsibility Assignment Matrix</p>
            </div>
            <div class="controls">
                <button class="btn" onclick="toggleTheme()">üåô Dark Mode</button>
                <button class="btn" onclick="exportData()">üìä Export</button>
                <a href="index.html" class="btn">‚Üê Dashboard</a>
            </div>
        </header>

        <div class="domain-tabs" id="domain-tabs"></div>
        <div id="domains-container"></div>
    </div>

    <script>
        const STORAGE_KEY = 'raci_matrix';
        let currentDomain = 'builders';

        window.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            initDomains();
            renderAllDomains();
        });

        function toggleTheme() {
            const body = document.body;
            const btn = document.querySelector('.controls .btn');
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                btn.textContent = 'üåô Dark Mode';
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                btn.textContent = '‚òÄÔ∏è Light Mode';
                localStorage.setItem('theme', 'dark');
            }
        }

        function loadTheme() {
            const theme = localStorage.getItem('theme');
            const btn = document.querySelector('.controls .btn');
            if (theme === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
                btn.textContent = '‚òÄÔ∏è Light Mode';
            }
        }

        function initDomains() {
            const domains = getAvailableDomains();
            const tabsContainer = document.getElementById('domain-tabs');
            const domainsContainer = document.getElementById('domains-container');
            
            tabsContainer.innerHTML = '';
            domainsContainer.innerHTML = '';
            
            domains.forEach((domain, index) => {
                // Create tab
                const tab = document.createElement('button');
                tab.className = index === 0 ? 'tab active' : 'tab';
                tab.textContent = domain.label;
                tab.onclick = () => switchTab(domain.id);
                tabsContainer.appendChild(tab);
                
                // Create content
                const content = document.createElement('div');
                content.id = domain.id;
                content.className = index === 0 ? 'domain-content active' : 'domain-content';
                content.innerHTML = `
                    <!-- RACI Legend -->
                    <div class="raci-legend">
                        <h3 class="section-header">RACI Matrix Guide</h3>
                        <div class="legend-grid">
                            <div class="legend-item">
                                <span class="legend-badge">R</span>
                                <div class="legend-desc">
                                    <strong>Responsible</strong>
                                    Performs the work to complete the task
                                </div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-badge">A</span>
                                <div class="legend-desc">
                                    <strong>Accountable</strong>
                                    Ultimate decision maker and owner
                                </div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-badge">C</span>
                                <div class="legend-desc">
                                    <strong>Consulted</strong>
                                    Provides input and feedback
                                </div>
                            </div>
                            <div class="legend-item">
                                <span class="legend-badge">I</span>
                                <div class="legend-desc">
                                    <strong>Informed</strong>
                                    Kept updated on progress
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Statistics Overview -->
                    <div class="stats-overview">
                        <h3 class="section-header">${domain.label} - Overview</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="${domain.id}-team-count">0</div>
                                <div class="stat-label">Team Members</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="${domain.id}-task-count">0</div>
                                <div class="stat-label">Total Tasks</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="${domain.id}-completed-count">0</div>
                                <div class="stat-label">Completed</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="${domain.id}-progress">0%</div>
                                <div class="stat-label">Progress</div>
                            </div>
                        </div>
                    </div>

                    <div class="team-section">
                        <h3 class="section-header">Team Members</h3>
                        <div class="team-list" id="${domain.id}-team-list"></div>
                        <div class="add-member-form">
                            <input type="text" id="${domain.id}-new-member" placeholder="Team member name">
                            <button class="btn-add" onclick="addTeamMember('${domain.id}')">+ Add Member</button>
                        </div>
                    </div>
                    <div class="team-section">
                        <h3 class="section-header">Tasks & Deliverables</h3>
                        <button class="btn-add" onclick="addTask('${domain.id}')">+ Add Task</button>
                        <table class="matrix-table" id="${domain.id}-matrix"></table>
                    </div>
                    <div class="accountability-alert" id="${domain.id}-alert" style="display: none;">
                        <strong>‚ö†Ô∏è Accountability Alert:</strong>
                        <div id="${domain.id}-alert-text"></div>
                    </div>
                `;
                domainsContainer.appendChild(content);
            });
            
            if (domains.length > 0) {
                currentDomain = domains[0].id;
            }
        }

        function getAvailableDomains() {
            const defaultDomains = [
                { id: 'builders', label: "Builder's Conference" },
                { id: 'professional', label: 'Professional/Career' },
                { id: 'chess', label: 'Chess Not Checkers' }
            ];
            
            // Get custom domains from dashboard
            const customDomains = JSON.parse(localStorage.getItem('customDomains') || '[]');
            
            return [...defaultDomains, ...customDomains.map(d => ({
                id: d.id,
                label: d.label || d.name
            }))];
        }

        function switchTab(domainId) {
            currentDomain = domainId;
            document.querySelectorAll('.domain-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(domainId).classList.add('active');
            event.target.classList.add('active');
        }

        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (!saved) {
                const domains = getAvailableDomains();
                const data = {};
                domains.forEach(d => {
                    data[d.id] = { team: [], tasks: [] };
                });
                return data;
            }
            return JSON.parse(saved);
        }

        function saveData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function addTeamMember(domainId) {
            const input = document.getElementById(`${domainId}-new-member`);
            const name = input.value.trim();
            if (name) {
                const data = loadData();
                if (!data[domainId]) data[domainId] = { team: [], tasks: [] };
                data[domainId].team.push(name);
                saveData(data);
                input.value = '';
                renderDomain(domainId);
            }
        }

        function removeTeamMember(domainId, index) {
            const data = loadData();
            data[domainId].team.splice(index, 1);
            saveData(data);
            renderDomain(domainId);
        }

        function addTask(domainId) {
            const data = loadData();
            if (!data[domainId]) data[domainId] = { team: [], tasks: [] };
            data[domainId].tasks.push({
                name: '',
                status: 'not-started',
                completed: false,
                responsible: {},
                accountable: {},
                consulted: {},
                informed: {}
            });
            saveData(data);
            renderDomain(domainId);
        }

        function deleteTask(domainId, index) {
            if (!confirm('Delete this task?')) return;
            const data = loadData();
            data[domainId].tasks.splice(index, 1);
            saveData(data);
            renderDomain(domainId);
        }

        function updateTask(domainId, taskIndex, field, value) {
            const data = loadData();
            data[domainId].tasks[taskIndex][field] = value;
            saveData(data);
        }

        function toggleRaci(domainId, taskIndex, member, role) {
            const data = loadData();
            const task = data[domainId].tasks[taskIndex];
            task[role][member] = !task[role][member];
            saveData(data);
            renderDomain(domainId);
        }

        function renderDomain(domainId) {
            const data = loadData();
            if (!data[domainId]) data[domainId] = { team: [], tasks: [] };
            const domainData = data[domainId];
            
            // Update statistics
            const teamCount = domainData.team.length;
            const taskCount = domainData.tasks.length;
            const completedCount = domainData.tasks.filter(t => t.completed).length;
            const progress = taskCount > 0 ? Math.round((completedCount / taskCount) * 100) : 0;
            
            const teamCountEl = document.getElementById(`${domainId}-team-count`);
            const taskCountEl = document.getElementById(`${domainId}-task-count`);
            const completedCountEl = document.getElementById(`${domainId}-completed-count`);
            const progressEl = document.getElementById(`${domainId}-progress`);
            
            if (teamCountEl) teamCountEl.textContent = teamCount;
            if (taskCountEl) taskCountEl.textContent = taskCount;
            if (completedCountEl) completedCountEl.textContent = completedCount;
            if (progressEl) progressEl.textContent = `${progress}%`;
            
            // Render team
            const teamList = document.getElementById(`${domainId}-team-list`);
            teamList.innerHTML = domainData.team.map((member, i) => `
                <div class="team-member">
                    ${member}
                    <span class="remove-member" onclick="removeTeamMember('${domainId}', ${i})">√ó</span>
                </div>
            `).join('');
            
            // Check for accountability issues
            const tasksWithoutAccountable = domainData.tasks.filter(task => {
                return !Object.values(task.accountable).some(v => v);
            });
            
            const alertDiv = document.getElementById(`${domainId}-alert`);
            const alertText = document.getElementById(`${domainId}-alert-text`);
            
            if (tasksWithoutAccountable.length > 0) {
                alertDiv.style.display = 'block';
                alertText.innerHTML = `${tasksWithoutAccountable.length} task(s) have no one marked as Accountable. Every task must have exactly one person Accountable.`;
            } else {
                alertDiv.style.display = 'none';
            }
            
            // Render matrix
            const matrix = document.getElementById(`${domainId}-matrix`);
            if (domainData.tasks.length === 0) {
                matrix.innerHTML = '<tr><td colspan="100%" style="text-align: center; padding: 20px; color: var(--text-muted);">No tasks yet. Click "+ Add Task" to get started.</td></tr>';
                return;
            }
            
            matrix.innerHTML = `
                <thead>
                    <tr>
                        <th style="min-width: 50px;">Done</th>
                        <th style="min-width: 200px;">Task</th>
                        ${domainData.team.map(member => `
                            <th colspan="4" style="text-align: center; border-left: 1px solid var(--border-color);">
                                ${member}
                                <div style="display: flex; gap: 4px; justify-content: center; margin-top: 4px; font-size: 9px;">
                                    <span>R</span><span>A</span><span>C</span><span>I</span>
                                </div>
                            </th>
                        `).join('')}
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${domainData.tasks.map((task, taskIndex) => `
                        <tr style="${task.completed ? 'opacity: 0.6;' : ''}">
                            <td style="text-align: center;">
                                <input type="checkbox" class="status-checkbox"
                                    ${task.completed ? 'checked' : ''}
                                    onchange="toggleCompleted('${domainId}', ${taskIndex}, this.checked)">
                            </td>
                            <td>
                                <input type="text" 
                                       value="${task.name}" 
                                       onchange="updateTask('${domainId}', ${taskIndex}, 'name', this.value)"
                                       placeholder="Task name"
                                       style="${task.completed ? 'text-decoration: line-through;' : ''}">
                            </td>
                            ${domainData.team.map(member => `
                                <td class="raci-cell"><input type="checkbox" class="raci-checkbox" 
                                    ${task.responsible[member] ? 'checked' : ''}
                                    onchange="toggleRaci('${domainId}', ${taskIndex}, '${member}', 'responsible')"></td>
                                <td class="raci-cell"><input type="checkbox" class="raci-checkbox"
                                    ${task.accountable[member] ? 'checked' : ''}
                                    onchange="toggleRaci('${domainId}', ${taskIndex}, '${member}', 'accountable')"></td>
                                <td class="raci-cell"><input type="checkbox" class="raci-checkbox"
                                    ${task.consulted[member] ? 'checked' : ''}
                                    onchange="toggleRaci('${domainId}', ${taskIndex}, '${member}', 'consulted')"></td>
                                <td class="raci-cell"><input type="checkbox" class="raci-checkbox"
                                    ${task.informed[member] ? 'checked' : ''}
                                    onchange="toggleRaci('${domainId}', ${taskIndex}, '${member}', 'informed')"></td>
                            `).join('')}
                            <td>
                                <button class="delete-task" onclick="deleteTask('${domainId}', ${taskIndex})">üóëÔ∏è</button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            `;
        }

        function toggleCompleted(domainId, taskIndex, completed) {
            const data = loadData();
            data[domainId].tasks[taskIndex].completed = completed;
            saveData(data);
            renderDomain(domainId);
        }

        function renderAllDomains() {
            const domains = getAvailableDomains();
            domains.forEach(domain => renderDomain(domain.id));
        }

        function exportData() {
            const data = { timestamp: new Date().toISOString(), raci: loadData() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `raci-matrix-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
